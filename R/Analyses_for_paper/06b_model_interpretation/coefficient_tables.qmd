---
title: "Coefficient Tables"
format: pdf
echo: false
warning: false
message: false
error: true
---

These tables are using the full model averaging method, without removal of nesting models. SEs are adjusted (inflated/unconditional) as recommended by Grueber et al. 2011.  

Coefficients and importance may change when removing more complicated models so should potentially work this in??? It gets so complex to add columns but we can try it......


```{r}
library(dplyr)
library(tibble)
library(purrr)
library(MuMIn)
library(gt)

options(scipen = 999)
```

# Chl a trends  

```{r}
# get needed data frames
load(here::here("Outputs",
                "06_model_selection",
                "R_objects",
                "chla_post-averaging.RData"))
```

## Delta < 4  

```{r}
mods <- mod_avgd4
mods_nonnested <- model.avg(top_modsd4_unnested)
```

```{r}
# all
coeffsd4 <- as.data.frame(coefTable(mods, full = TRUE, adjust.se = TRUE)) |> 
  rownames_to_column() |> 
  set_names(c("Term", "Estimate", "Adjusted.SE", "df")) |> 
  select(-df) |> 
  mutate(across(c(Estimate, Adjusted.SE),
                function(x) round(x, 4)))

wts <- sw(mods) 
n.mods <- attributes(wts)$n.models

wts <- as.data.frame(wts) |> 
  rownames_to_column("Term")
n.mods <- as.data.frame(n.mods) |> 
  rownames_to_column("Term")

coeffs_joined_allMods <- coeffsd4 |> 
  full_join(wts, by = "Term") |> 
  full_join(n.mods, by = "Term") |> 
  mutate(wts = round(wts, 2))

names(coeffs_joined_allMods)[2:ncol(coeffs_joined_allMods)] <- paste0("All_", names(coeffs_joined_allMods)[2:ncol(coeffs_joined_allMods)] )
```


```{r}
# only simple models
coeffsd4 <- as.data.frame(coefTable(mods_nonnested, full = TRUE, adjust.se = TRUE)) |> 
  rownames_to_column() |> 
  set_names(c("Term", "Estimate", "Adjusted.SE", "df")) |> 
  select(-df) |> 
  mutate(across(c(Estimate, Adjusted.SE),
                function(x) round(x, 4)))

wts <- sw(mods_nonnested) 
n.mods <- attributes(wts)$n.models

wts <- as.data.frame(wts) |> 
  rownames_to_column("Term")
n.mods <- as.data.frame(n.mods) |> 
  rownames_to_column("Term")

coeffs_joined_nonnestedMods <- coeffsd4 |> 
  full_join(wts, by = "Term") |> 
  full_join(n.mods, by = "Term") |> 
  mutate(wts = round(wts, 2))

names(coeffs_joined_nonnestedMods)[2:ncol(coeffs_joined_nonnestedMods)] <- paste0("Simple_", names(coeffs_joined_nonnestedMods)[2:ncol(coeffs_joined_nonnestedMods)] )
```


```{r}
coeffs_combined_d4 <- full_join(coeffs_joined_allMods,
                             coeffs_joined_nonnestedMods,
                             by = "Term") |> 
  arrange(desc(All_wts))
```

```{r}
gt(coeffs_combined_d4)
```


## Delta < 2  

```{r}
mods <- model.avg(top_modsd2)
mods_nonnested <- model.avg(top_modsd2_unnested)
```

```{r}
# all
coeffsd4 <- as.data.frame(coefTable(mods, full = TRUE, adjust.se = TRUE)) |> 
  rownames_to_column() |> 
  set_names(c("Term", "Estimate", "Adjusted.SE", "df")) |> 
  select(-df) |> 
  mutate(across(c(Estimate, Adjusted.SE),
                function(x) round(x, 4)))

wts <- sw(mods) 
n.mods <- attributes(wts)$n.models

wts <- as.data.frame(wts) |> 
  rownames_to_column("Term")
n.mods <- as.data.frame(n.mods) |> 
  rownames_to_column("Term")

coeffs_joined_allMods <- coeffsd4 |> 
  full_join(wts, by = "Term") |> 
  full_join(n.mods, by = "Term") |> 
  mutate(wts = round(wts, 2))

names(coeffs_joined_allMods)[2:ncol(coeffs_joined_allMods)] <- paste0("All_", names(coeffs_joined_allMods)[2:ncol(coeffs_joined_allMods)] )
```


```{r}
# only simple models
coeffsd4 <- as.data.frame(coefTable(mods_nonnested, full = TRUE, adjust.se = TRUE)) |> 
  rownames_to_column() |> 
  set_names(c("Term", "Estimate", "Adjusted.SE", "df")) |> 
  select(-df) |> 
  mutate(across(c(Estimate, Adjusted.SE),
                function(x) round(x, 4)))

wts <- sw(mods_nonnested) 
n.mods <- attributes(wts)$n.models

wts <- as.data.frame(wts) |> 
  rownames_to_column("Term")
n.mods <- as.data.frame(n.mods) |> 
  rownames_to_column("Term")

coeffs_joined_nonnestedMods <- coeffsd4 |> 
  full_join(wts, by = "Term") |> 
  full_join(n.mods, by = "Term") |> 
  mutate(wts = round(wts, 2))

names(coeffs_joined_nonnestedMods)[2:ncol(coeffs_joined_nonnestedMods)] <- paste0("Simple_", names(coeffs_joined_nonnestedMods)[2:ncol(coeffs_joined_nonnestedMods)] )
```


```{r}
coeffs_combined_d2 <- full_join(coeffs_joined_allMods,
                             coeffs_joined_nonnestedMods,
                             by = "Term") |> 
  arrange(desc(All_wts))
```

```{r}
gt(coeffs_combined_d2)
```


## Delta < 6  

```{r}
mods <- model.avg(top_modsd6)
mods_nonnested <- model.avg(top_modsd6_unnested)
```

```{r}
# all
coeffsd4 <- as.data.frame(coefTable(mods, full = TRUE, adjust.se = TRUE)) |> 
  rownames_to_column() |> 
  set_names(c("Term", "Estimate", "Adjusted.SE", "df")) |> 
  select(-df) |> 
  mutate(across(c(Estimate, Adjusted.SE),
                function(x) round(x, 4)))

wts <- sw(mods) 
n.mods <- attributes(wts)$n.models

wts <- as.data.frame(wts) |> 
  rownames_to_column("Term")
n.mods <- as.data.frame(n.mods) |> 
  rownames_to_column("Term")

coeffs_joined_allMods <- coeffsd4 |> 
  full_join(wts, by = "Term") |> 
  full_join(n.mods, by = "Term") |> 
  mutate(wts = round(wts, 2))

names(coeffs_joined_allMods)[2:ncol(coeffs_joined_allMods)] <- paste0("All_", names(coeffs_joined_allMods)[2:ncol(coeffs_joined_allMods)] )
```


```{r}
# only simple models
coeffsd4 <- as.data.frame(coefTable(mods_nonnested, full = TRUE, adjust.se = TRUE)) |> 
  rownames_to_column() |> 
  set_names(c("Term", "Estimate", "Adjusted.SE", "df")) |> 
  select(-df) |> 
  mutate(across(c(Estimate, Adjusted.SE),
                function(x) round(x, 4)))

wts <- sw(mods_nonnested) 
n.mods <- attributes(wts)$n.models

wts <- as.data.frame(wts) |> 
  rownames_to_column("Term")
n.mods <- as.data.frame(n.mods) |> 
  rownames_to_column("Term")

coeffs_joined_nonnestedMods <- coeffsd4 |> 
  full_join(wts, by = "Term") |> 
  full_join(n.mods, by = "Term") |> 
  mutate(wts = round(wts, 2))

names(coeffs_joined_nonnestedMods)[2:ncol(coeffs_joined_nonnestedMods)] <- paste0("Simple_", names(coeffs_joined_nonnestedMods)[2:ncol(coeffs_joined_nonnestedMods)] )
```


```{r}
coeffs_combined_d6 <- full_join(coeffs_joined_allMods,
                             coeffs_joined_nonnestedMods,
                             by = "Term") |> 
  arrange(desc(All_wts))
```

```{r}
gt(coeffs_combined_d6)
```

# DO mgl trends  



# DO<2 trends  